<!-- Elements added to main will be displayed on all pages -->

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.2">
    
    
      
        <title>Postgres Metrics - DX Test Site</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.f7951f6f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#poc-goals" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="DX Test Site" class="md-header__button md-logo" aria-label="DX Test Site" data-md-component="logo">
      
  <img src="../../../assets/dx_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DX Test Site
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Postgres Metrics
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../what%27s-new/new_cf17/" class="md-tabs__link">
        What's new
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link md-tabs__link--active">
        Kube
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="DX Test Site" class="md-nav__button md-logo" aria-label="DX Test Site" data-md-component="logo">
      
  <img src="../../../assets/dx_logo.png" alt="logo">

    </a>
    DX Test Site
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          What's new
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="What's new" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          What's new
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_cf17/" class="md-nav__link">
        What's new in CF17?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_cf171/" class="md-nav__link">
        What's new in CF171? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_cf172/" class="md-nav__link">
        What's new in CF172? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_cf173/" class="md-nav__link">
        What's new in CF173? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_cf18/" class="md-nav__link">
        What's new in CF18? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_noncf18/" class="md-nav__link">
        What's new in CF18?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf182/" class="md-nav__link">
        What's new in CF182? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf183/" class="md-nav__link">
        What's new in CF183? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf184/" class="md-nav__link">
        What's new in CF184? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf19/" class="md-nav__link">
        What's new in CF19? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_noncf19/" class="md-nav__link">
        What's new with CF19?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf191/" class="md-nav__link">
        What's new in CF191? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf192/" class="md-nav__link">
        What's new in CF192? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf193/" class="md-nav__link">
        What's new in CF193? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf194/" class="md-nav__link">
        What's new in CF194? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf195/" class="md-nav__link">
        What's new in CF195? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf196/" class="md-nav__link">
        What's new in CF196? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_noncf196/" class="md-nav__link">
        What's new in CF196?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf197/" class="md-nav__link">
        What's new in CF197? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_noncf197/" class="md-nav__link">
        What's new with CF197?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf198/" class="md-nav__link">
        What's new in CF198? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_noncf198/" class="md-nav__link">
        What's new with CF198?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf199/" class="md-nav__link">
        What's new in CF199? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_noncf199/" class="md-nav__link">
        What's new with CF199?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_cf181/" class="md-nav__link">
        What's new in CF181? Containers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../">Kube</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Kube" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Kube
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-next-deploy/" class="md-nav__link">
        Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-next-operation/" class="md-nav__link">
        Operations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-next-runtime-log-levels/" class="md-nav__link">
        Runtime log levels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-next-runtime-log-levels-dbha/" class="md-nav__link">
        Runtime log levels - DBHA
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6" type="checkbox" id="__nav_3_6" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_6">
          Prometheus
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Prometheus" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Prometheus
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../k8s-next-nodejs-prom/" class="md-nav__link">
        NodeJS Metrics
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Postgres Metrics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Postgres Metrics
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#poc-goals" class="md-nav__link">
    PoC Goals
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgres-metrics" class="md-nav__link">
    Postgres Metrics
  </a>
  
    <nav class="md-nav" aria-label="Postgres Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-a-sidecar-container-to-the-postgres-pod" class="md-nav__link">
    Adding a sidecar container to the Postgres Pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-postgres-exporter-image-based-on-the-ubi-image" class="md-nav__link">
    Create Postgres Exporter image based on the UBI image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pgpool-metrics" class="md-nav__link">
    Pgpool Metrics
  </a>
  
    <nav class="md-nav" aria-label="Pgpool Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-a-sidecar-container-to-the-pgpool-pod" class="md-nav__link">
    Adding a sidecar container to the Pgpool Pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-pgpool-exporter-image-based-on-the-ubi-image" class="md-nav__link">
    Create Pgpool Exporter image based on the UBI image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-existing-grafana-dashboards" class="md-nav__link">
    Using existing Grafana Dashboards
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../k8s-next-prom/" class="md-nav__link">
        Prometheus
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_7" data-md-state="indeterminate" type="checkbox" id="__nav_3_7" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_7">
          Migration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Migration" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          Migration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Migration/k8s-next-migrate-from-operator/" class="md-nav__link">
        Operator migration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Migration/k8s-next-migrate-detail-core/" class="md-nav__link">
        Operator migration - core
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Migration/k8s-next-migrate-detail-dam/" class="md-nav__link">
        Operator migration - DAM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Migration/k8s-next-property-migration/" class="md-nav__link">
        Operator property migration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-next-update/" class="md-nav__link">
        Updating
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-next-undeploy/" class="md-nav__link">
        Undeploy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-next-conclusion/" class="md-nav__link">
        Conclusion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-next-helm-incubator-values/" class="md-nav__link">
        Incubator configurations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#poc-goals" class="md-nav__link">
    PoC Goals
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgres-metrics" class="md-nav__link">
    Postgres Metrics
  </a>
  
    <nav class="md-nav" aria-label="Postgres Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-a-sidecar-container-to-the-postgres-pod" class="md-nav__link">
    Adding a sidecar container to the Postgres Pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-postgres-exporter-image-based-on-the-ubi-image" class="md-nav__link">
    Create Postgres Exporter image based on the UBI image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pgpool-metrics" class="md-nav__link">
    Pgpool Metrics
  </a>
  
    <nav class="md-nav" aria-label="Pgpool Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-a-sidecar-container-to-the-pgpool-pod" class="md-nav__link">
    Adding a sidecar container to the Pgpool Pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-pgpool-exporter-image-based-on-the-ubi-image" class="md-nav__link">
    Create Pgpool Exporter image based on the UBI image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-existing-grafana-dashboards" class="md-nav__link">
    Using existing Grafana Dashboards
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

  <h1>Postgres Metrics</h1>

<h2 id="poc-goals">PoC Goals</h2>
<p>The goal is to evaluate how we can expose Prometheus compatible metrics in our Postgres persistence. The outcome of that PoC should be documented so it can be reused for a thorough implementation in our Helm deployment.</p>
<p>The PoC will use the new persistence deployment with <a href="https://www.pgpool.net/">Pgpool</a> and <a href="https://repmgr.org/">Repmgr</a> (DX internally called <em>"dbHA"</em>), but the described pattern can be used for the "old" persistence as well.</p>
<h2 id="postgres-metrics">Postgres Metrics</h2>
<p>A Postgres Prometheus exporter exists as a prebuilt Docker image as well as <a href="https://github.com/prometheus-community/postgres_exporter">on Github</a>. It connects to the database and exposes the Prometheus compatible metrics as an HTTP endpoint. The default metrics are described in the <a href="https://github.com/prometheus-community/postgres_exporter/blob/master/queries.yaml"><code>queries.yaml</code></a> file. Custom metrics can be defined as a YAML file and attached when the exporter is started by using the <a href="https://github.com/prometheus-community/postgres_exporter#flags"><code>extend.query-path</code> flag</a>.</p>
<h3 id="adding-a-sidecar-container-to-the-postgres-pod">Adding a sidecar container to the Postgres Pod</h3>
<p>The preferred way to run the Exporter is to add it to the Postgres Pod as a sidecar container. The configuration below describes the basic setup using the public postgres-exporter image.</p>
<pre><code class="language-yaml">spec:
  template:
    metadata:
      annotations:
        # Tell Prometheus to scrape the metrics and where to find them
        prometheus.io/path: &quot;/metrics&quot;
        prometheus.io/port: &quot;9187&quot;
        prometheus.io/scrape: &quot;true&quot;
    spec:
      containers:
        - name: &quot;persistence-node-metrics&quot;
          image: &quot;quay.io/prometheuscommunity/postgres-exporter&quot;
          env:
            - name: DATA_SOURCE_URI
              # If implemented like that, we should check fo a way to not hard-code the &quot;dxmediadb&quot;
              value: &quot;127.0.0.1:5432/dxmediadb?sslmode=disable&quot;
            - name: &quot;DATA_SOURCE_PASS&quot;
              valueFrom:
                secretKeyRef:
                  key: &quot;password&quot;
                  name: &quot;{{ .Release.Name }}-persistence-user&quot;
            - name: &quot;DATA_SOURCE_USER&quot;
              valueFrom:
                secretKeyRef:
                  key: &quot;username&quot;
                  name: &quot;{{ .Release.Name }}-persistence-user&quot;
          ports:
            - name: metrics
              containerPort: 9187
              protocol: TCP
</code></pre>
<h3 id="create-postgres-exporter-image-based-on-the-ubi-image">Create Postgres Exporter image based on the UBI image</h3>
<p>When shipped as part of DX, the Postgres Exporter should be included as a separate image, based on the UBI image. We can use the published releases from Github and add it to the UBI image.</p>
<pre><code class="language-Dockerfile">#
####################################################################
# Licensed Materials - Property of HCL                             #
#                                                                  #
# Copyright HCL Technologies Ltd. 2021. All Rights Reserved.       #
#                                                                  #
# Note to US Government Users Restricted Rights:                   #
#                                                                  #
# Use, duplication or disclosure restricted by GSA ADP Schedule    #
####################################################################
#

ARG REPOSITORY_URL=&quot;quintana-docker-prod.artifactory.cwp.pnp-hcl.com&quot;
ARG DOCKER_UBI_BASE_IMAGE=&quot;dx-build-output/common/dxubi:v1.0.0_8.4-205&quot;

FROM $REPOSITORY_URL/$DOCKER_UBI_BASE_IMAGE

ARG BUILD_LABEL
ARG VERSION

LABEL &quot;product&quot;=&quot;HCL Digital Experience Postgres exporter&quot;
LABEL &quot;version&quot;=&quot;${VERSION}&quot;
LABEL &quot;description&quot;=&quot;DX postgres exporter container&quot;
LABEL &quot;io.k8s.description&quot;=&quot;DX postgres exporter container&quot;
LABEL &quot;io.k8s.display-name&quot;=&quot;DX postgres exporter container&quot;
LABEL &quot;summary&quot;=&quot;DX postgres exporter container&quot;
LABEL &quot;name&quot;=&quot;dx-postgresql-exporter&quot;
LABEL &quot;release&quot;=&quot;${BUILD_LABEL}&quot;
LABEL &quot;maintainer&quot;=&quot;HCL Software&quot;
LABEL &quot;vendor&quot;=&quot;HCL Software&quot;
LABEL &quot;io.openshift.tags&quot;=&quot;hcl dx&quot;
LABEL &quot;url&quot;=&quot;&quot;
LABEL &quot;authoritative-source-url&quot;=&quot;&quot;

MAINTAINER HCL Software

RUN curl -LJO https://github.com/prometheus-community/postgres_exporter/releases/download/v0.10.0/postgres_exporter-0.10.0.linux-amd64.tar.gz &amp;&amp; \
    tar -xvf postgres_exporter-0.10.0.linux-amd64.tar.gz &amp;&amp; \
    rm postgres_exporter-0.10.0.linux-amd64.tar.gz &amp;&amp; \
    mv postgres_exporter-0.10.0.linux-amd64/postgres_exporter /usr/bin/postgres_exporter &amp;&amp; \
    rm -r postgres_exporter-0.10.0.linux-amd64

USER dx_user:dx_users
EXPOSE 9187
ENTRYPOINT [&quot;/usr/bin/postgres_exporter&quot;]
</code></pre>
<h2 id="pgpool-metrics">Pgpool Metrics</h2>
<p>Similar to the Postgres exporter, a docker image exists to export the metrics of Pgpool. The code and releases can be found <a href="https://github.com/pgpool/pgpool2_exporter">on Github</a>. The exposed metrics are described on the same page. As we are currently using Pgpool in version 4.1, some of the metrics are not available for the exporter. To use it to it's full potential, an upgrade of Pgpool to version 4.2 should be considered.</p>
<h3 id="adding-a-sidecar-container-to-the-pgpool-pod">Adding a sidecar container to the Pgpool Pod</h3>
<p>The preferred way to run the Exporter is to add it to the Pgpool Pod as a sidecar container. The configuration below describes the basic setup using the public pgpool-exporter image.</p>
<pre><code class="language-yaml">spec:
  template:
    metadata:
      annotations:
        # Tell Prometheus to scrape the metrics and where to find them
        prometheus.io/path: &quot;/metrics&quot;
        prometheus.io/port: &quot;9719&quot;
        prometheus.io/scrape: &quot;true&quot;
    spec:
      containers:
        - name: &quot;persistence-connection-pool-stats&quot;
          image: pgpool/pgpool2_exporter
          env:
          - name: &quot;POSTGRES_USERNAME&quot;
            valueFrom:
              secretKeyRef:
                key: &quot;username&quot;
                name: &quot;{{ .Release.Name }}-persistence-user&quot; 
          - name: &quot;POSTGRES_PASSWORD&quot;
            valueFrom:
              secretKeyRef:
                key: &quot;password&quot;
                name: &quot;{{ .Release.Name }}-persistence-user&quot;      
          - name: PGPOOL_SERVICE
            value: &quot;localhost&quot;
          - name: PGPOOL_SERVICE_PORT
            value: &quot;5432&quot;
          ports:
            - name: metrics
              containerPort: 9719
              protocol: TCP
</code></pre>
<h3 id="create-pgpool-exporter-image-based-on-the-ubi-image">Create Pgpool Exporter image based on the UBI image</h3>
<p>When shipped as part of DX, the Pgpool Exporter should be included as a separate image, based on the UBI image. We can use the published releases from Github and add it to the UBI image.</p>
<pre><code class="language-Dockerfile">#
####################################################################
# Licensed Materials - Property of HCL                             #
#                                                                  #
# Copyright HCL Technologies Ltd. 2021. All Rights Reserved.       #
#                                                                  #
# Note to US Government Users Restricted Rights:                   #
#                                                                  #
# Use, duplication or disclosure restricted by GSA ADP Schedule    #
####################################################################
#

ARG REPOSITORY_URL=&quot;quintana-docker-prod.artifactory.cwp.pnp-hcl.com&quot;
ARG DOCKER_UBI_BASE_IMAGE=&quot;dx-build-output/common/dxubi:v1.0.0_8.4-205&quot;

FROM $REPOSITORY_URL/$DOCKER_UBI_BASE_IMAGE

ARG BUILD_LABEL
ARG VERSION

LABEL &quot;product&quot;=&quot;HCL Digital Experience Pgpool exporter&quot;
LABEL &quot;version&quot;=&quot;${VERSION}&quot;
LABEL &quot;description&quot;=&quot;DX pgpool exporter container&quot;
LABEL &quot;io.k8s.description&quot;=&quot;DX pgpool exporter container&quot;
LABEL &quot;io.k8s.display-name&quot;=&quot;DX pgpool exporter container&quot;
LABEL &quot;summary&quot;=&quot;DX pgpool exporter container&quot;
LABEL &quot;name&quot;=&quot;dx-pgpool-exporter&quot;
LABEL &quot;release&quot;=&quot;${BUILD_LABEL}&quot;
LABEL &quot;maintainer&quot;=&quot;HCL Software&quot;
LABEL &quot;vendor&quot;=&quot;HCL Software&quot;
LABEL &quot;io.openshift.tags&quot;=&quot;hcl dx&quot;
LABEL &quot;url&quot;=&quot;&quot;
LABEL &quot;authoritative-source-url&quot;=&quot;&quot;

MAINTAINER HCL Software

ENV POSTGRES_USERNAME postgres
ENV POSTGRES_PASSWORD postgres
ENV PGPOOL_SERVICE localhost
ENV PGPOOL_SERVICE_PORT 9999

RUN curl -LJO https://github.com/pgpool/pgpool2_exporter/releases/download/v1.0.0/pgpool2_exporter-1.0.0.linux-amd64.tar.gz &amp;&amp; \
    tar -xvf pgpool2_exporter-1.0.0.linux-amd64.tar.gz &amp;&amp; \
    rm pgpool2_exporter-1.0.0.linux-amd64.tar.gz &amp;&amp; \
    mv pgpool2_exporter-1.0.0.linux-amd64/pgpool2_exporter /usr/bin/pgpool2_exporter &amp;&amp; \
    rm -r pgpool2_exporter-1.0.0.linux-amd64

USER dx_user:dx_users
EXPOSE 9719
ENTRYPOINT [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;export DATA_SOURCE_NAME=\&quot;postgresql://${POSTGRES_USERNAME}:${POSTGRES_PASSWORD}@${PGPOOL_SERVICE}:${PGPOOL_SERVICE_PORT}/postgres?sslmode=disable\&quot;; /usr/bin/pgpool2_exporter&quot;]
</code></pre>
<h2 id="using-existing-grafana-dashboards">Using existing Grafana Dashboards</h2>
<p>There are also existing Grafana dashboards that can be leveraged.</p>
<p>One that is related to Postgres with Prometheuse can be found here <a href="https://grafana.com/grafana/dashboards/9628">Grafana Dashboard 9628</a>. For the Pgpool exporter, a predefined Dashboard is not available in the official Grafana Dashboard directory.</p>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
 

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.indexes", "navigation.top", "navigation.instant", "navigation.expand", "search.highlight", "search.share", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.0bbba5b5.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.649a939e.min.js"></script>
      
    
  </body>
</html>