<!-- Elements added to main will be displayed on all pages -->

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.4">
    
    
      
        <title>Operator migration - core - DX Test Site</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.bb3983ee.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#migration-mode-for-the-helm-deployment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../../.."> 


    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="DX Test Site" class="md-header__button md-logo" aria-label="DX Test Site" data-md-component="logo">
      
  <img src="../../../assets/dx_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DX Test Site
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Operator migration - core
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../what%27s-new/new_cf17/" class="md-tabs__link">
        What's new
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link md-tabs__link--active">
        Kube
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="DX Test Site" class="md-nav__button md-logo" aria-label="DX Test Site" data-md-component="logo">
      
  <img src="../../../assets/dx_logo.png" alt="logo">

    </a>
    DX Test Site
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          What's new
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="What's new" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          What's new
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_cf17/" class="md-nav__link">
        What's new in CF17?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_cf171/" class="md-nav__link">
        What's new in CF171? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_cf172/" class="md-nav__link">
        What's new in CF172? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_cf173/" class="md-nav__link">
        What's new in CF173? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_cf18/" class="md-nav__link">
        What's new in CF18? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_noncf18/" class="md-nav__link">
        What's new in CF18?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf182/" class="md-nav__link">
        What's new in CF182? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf183/" class="md-nav__link">
        What's new in CF183? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf184/" class="md-nav__link">
        What's new in CF184? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf19/" class="md-nav__link">
        What's new in CF19? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_noncf19/" class="md-nav__link">
        What's new with CF19?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf191/" class="md-nav__link">
        What's new in CF191? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf192/" class="md-nav__link">
        What's new in CF192? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf193/" class="md-nav__link">
        What's new in CF193? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf194/" class="md-nav__link">
        What's new in CF194? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf195/" class="md-nav__link">
        What's new in CF195? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf196/" class="md-nav__link">
        What's new in CF196? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_noncf196/" class="md-nav__link">
        What's new in CF196?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf197/" class="md-nav__link">
        What's new in CF197? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_noncf197/" class="md-nav__link">
        What's new with CF197?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf198/" class="md-nav__link">
        What's new in CF198? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_noncf198/" class="md-nav__link">
        What's new with CF198?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/newcf199/" class="md-nav__link">
        What's new in CF199? Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_noncf199/" class="md-nav__link">
        What's new with CF199?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../what%27s-new/new_cf181/" class="md-nav__link">
        What's new in CF181? Containers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../">Kube</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Kube" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Kube
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-next-deploy/" class="md-nav__link">
        Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-next-operation/" class="md-nav__link">
        Operations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-next-runtime-log-levels/" class="md-nav__link">
        Runtime log levels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-next-runtime-log-levels-dbha/" class="md-nav__link">
        Runtime log levels - DBHA
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6" data-md-state="indeterminate" type="checkbox" id="__nav_3_6" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_6">
          Prometheus
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Prometheus" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Prometheus
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Prometheus/k8s-next-nodejs-prom/" class="md-nav__link">
        NodeJS Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Prometheus/k8s-next-postgres-prom/" class="md-nav__link">
        Postgres Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Prometheus/k8s-next-prom/" class="md-nav__link">
        Prometheus
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_7" type="checkbox" id="__nav_3_7" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_7">
          Migration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Migration" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          Migration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../k8s-next-migrate-from-operator/" class="md-nav__link">
        Operator migration
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Operator migration - core
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Operator migration - core
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#migration-mode-for-the-helm-deployment" class="md-nav__link">
    Migration-Mode for the HELM deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backup-and-restore-process-raw-doc" class="md-nav__link">
    Backup and restore process (raw doc)
  </a>
  
    <nav class="md-nav" aria-label="Backup and restore process (raw doc)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backup-form-the-operator-based-deployment" class="md-nav__link">
    Backup form the operator based deployment
  </a>
  
    <nav class="md-nav" aria-label="Backup form the operator based deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ensure-that-only-one-core-pod-is-running" class="md-nav__link">
    1. Ensure that only one core pod is running
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-connecting-to-the-core-pod" class="md-nav__link">
    2. Connecting to the core pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-stop-the-server" class="md-nav__link">
    3. Stop the server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-compress-the-profile" class="md-nav__link">
    4. Compress the profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-download-the-backup-profile" class="md-nav__link">
    5. Download the backup profile
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restore-to-the-helm-based-deployment" class="md-nav__link">
    Restore to the HELM based deployment
  </a>
  
    <nav class="md-nav" aria-label="Restore to the HELM based deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-start-the-helm-deployment" class="md-nav__link">
    1. Start the HELM deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-upload-the-backup-profile" class="md-nav__link">
    2. Upload the backup profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-connect-to-the-core-pod" class="md-nav__link">
    3. Connect to the core pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-extracting-the-profile" class="md-nav__link">
    4. Extracting the profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-disable-the-migration-mode-and-the-deployment" class="md-nav__link">
    5. Disable the migration mode and the deployment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../k8s-next-migrate-detail-dam/" class="md-nav__link">
        Operator migration - DAM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../k8s-next-property-migration/" class="md-nav__link">
        Operator property migration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-next-update/" class="md-nav__link">
        Updating
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-next-undeploy/" class="md-nav__link">
        Undeploy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-next-conclusion/" class="md-nav__link">
        Conclusion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-next-helm-incubator-values/" class="md-nav__link">
        Incubator configurations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#migration-mode-for-the-helm-deployment" class="md-nav__link">
    Migration-Mode for the HELM deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backup-and-restore-process-raw-doc" class="md-nav__link">
    Backup and restore process (raw doc)
  </a>
  
    <nav class="md-nav" aria-label="Backup and restore process (raw doc)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backup-form-the-operator-based-deployment" class="md-nav__link">
    Backup form the operator based deployment
  </a>
  
    <nav class="md-nav" aria-label="Backup form the operator based deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ensure-that-only-one-core-pod-is-running" class="md-nav__link">
    1. Ensure that only one core pod is running
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-connecting-to-the-core-pod" class="md-nav__link">
    2. Connecting to the core pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-stop-the-server" class="md-nav__link">
    3. Stop the server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-compress-the-profile" class="md-nav__link">
    4. Compress the profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-download-the-backup-profile" class="md-nav__link">
    5. Download the backup profile
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restore-to-the-helm-based-deployment" class="md-nav__link">
    Restore to the HELM based deployment
  </a>
  
    <nav class="md-nav" aria-label="Restore to the HELM based deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-start-the-helm-deployment" class="md-nav__link">
    1. Start the HELM deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-upload-the-backup-profile" class="md-nav__link">
    2. Upload the backup profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-connect-to-the-core-pod" class="md-nav__link">
    3. Connect to the core pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-extracting-the-profile" class="md-nav__link">
    4. Extracting the profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-disable-the-migration-mode-and-the-deployment" class="md-nav__link">
    5. Disable the migration mode and the deployment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

  <h1>Operator migration - core</h1>

<p>This section will documented a overview how it is possible to migrate a core profile from a operator based deployment to a HELM based deployment. Also a output of this design is a first draft for the raw documentation.</p>
<h2 id="migration-mode-for-the-helm-deployment">Migration-Mode for the HELM deployment</h2>
<p>Before we can start to document the backup and restore/migration of the core profile we should implemented a migration mode. The goal of this mode is to start the core pod but without starting DX. The Pod should stay alive without DX runninng, so it is possible to connect to the pod and perform actions on the file system.</p>
<p>For the migration mode need to should adjust the following areas:</p>
<ul>
<li>Adding a migration parameter to the HELM chart</li>
<li>Liveness, readiness, startUp - checks</li>
<li>Core start scripts</li>
</ul>
<p>Here are some example implementations on how to do that, as I have tested this in feature branches.</p>
<ul>
<li>https://git.cwp.pnp-hcl.com/websphere-portal-incubator/dx-helm-charts/tree/feature/DXQ-19119</li>
<li>https://git.cwp.pnp-hcl.com/Team-Q/Portal-Docker-Images/compare/feature/DXQ-19119</li>
</ul>
<p>The migration mode should be also interested for DAM. Here are the needed changes.</p>
<p>HELM charts</p>
<pre><code>add config map entry

&quot;dam.config.dam.migration&quot;: &quot;{{ .Values.migration.enabled }}&quot;
</code></pre>
<pre><code># Liveness probe
{{- if .Values.migration.enabled }}
livenessProbe:
  exec:
    command:
    - /bin/sh
    - -c
    - exit 0
  failureThreshold: {{ .failureThreshold }}
  initialDelaySeconds: {{ .initialDelaySeconds }}
  periodSeconds: {{ .periodSeconds }}
  successThreshold: {{ .successThreshold }}
  timeoutSeconds: {{ .timeoutSeconds }}
{{ else }}
livenessProbe:
{{- with .Values.probes.digitalAssetManagement.livenessProbe }}
  {{- toYaml . | nindent 12 }}
{{- end }}
{{- end }}
# Readiness probe
{{- if .Values.migration.enabled }}
readinessProbe:
  exec:
    command:
    - /bin/sh
    - -c
    - exit 0
  failureThreshold: {{ .failureThreshold }}
  initialDelaySeconds: {{ .initialDelaySeconds }}
  periodSeconds: {{ .periodSeconds }}
  successThreshold: {{ .successThreshold }}
  timeoutSeconds: {{ .timeoutSeconds }}
{{ else }}
readinessProbe:
{{- with .Values.probes.digitalAssetManagement.readinessProbe }}
  {{- toYaml . | nindent 12 }}
{{- end }}
{{- end }}
</code></pre>
<p>Start scripts:</p>
<pre><code>#!/bin/bash

# Uses environment variables from a config map if mounted
for file in /etc/config/dam.config.dam.*; do
  # Loop through all the files in directory and check if file exists.
  if test -f &quot;$file&quot;; then
    # Split the filename into array with dot(.) delimiter.
    IFS='.' read -r -a array &lt;&lt;&lt; &quot;$(basename &quot;$file&quot;)&quot;
    # Get the last element of array for eg. postgres_db.
    envVariableTemp=${array[@]: -1:1}
    # Capitilise the string.
    envVariable=$(tr '[a-z]' '[A-Z]' &lt;&lt;&lt; $envVariableTemp)
    fileName=&quot;${file##*/}&quot;
    # Assign the variables with contents of file. eg. POSTGRES_DB='testdb'.
    printf -v $envVariable $(cat /etc/config/$fileName)
    # export the variable as environment variable.
    export $envVariable
  fi
done

clean_up () {
  echo &quot;Sending SIGTERM to all node instances...&quot;
  cd /opt/app/server-v1 &amp;&amp; npm run docker:stop-daemon
}

stop_container () {
  echo &quot;Caught SIGTERM, stopping DX Core container&quot;
  exit 0
}

echo &quot;Migration is: $MIGRATION&quot;

if [ &quot;$MIGRATION&quot; == &quot;true&quot; ]; then
  trap stop_container SIGTERM
  echo &quot;Listening for SIGTERM&quot;
  echo &quot;Migration is enabled, stay alive and do nothing ...&quot;
  # ensure the docker container stays alive and can listen for signals every second
  while true; do sleep 1; done
else
  trap clean_up SIGHUP SIGINT SIGTERM

  # run server version 1 
  cd /opt/app/server-v1 &amp;&amp; npm run docker:start
fi
</code></pre>
<h2 id="backup-and-restore-process-raw-doc">Backup and restore process (raw doc)</h2>
<p>This section documents the migration process of the core profile.</p>
<h3 id="backup-form-the-operator-based-deployment">Backup form the operator based deployment</h3>
<h4 id="1-ensure-that-only-one-core-pod-is-running">1. Ensure that only one core pod is running</h4>
<p>Check how many pods are running. Use the following command for that.</p>
<pre><code>kubectl -n &lt;namespace&gt; get all
</code></pre>
<p>If more then one core pod running, scaling down the core pods to only one. On the operator deployment adjust the DXCTL property file and apply this changes via the DXCTL tool.</p>
<h4 id="2-connecting-to-the-core-pod">2. Connecting to the core pod</h4>
<p>With the following command it is possible to jump directly into the running container.</p>
<pre><code>kubectl exec --stdin --tty pod/&lt;pod-name&gt; -n &lt;namespace&gt; -- /bin/bash
</code></pre>
<p>Example:</p>
<pre><code>kubectl exec --stdin --tty pod/dx-deployment-0 -n dxns -- /bin/bash
</code></pre>
<h4 id="3-stop-the-server">3. Stop the server</h4>
<p>Before a backup from the wp-profile can be create, the core application should be stopped. </p>
<p>Navigate to the profile <code>bin</code> folder and run the <code>stopServer</code> command.</p>
<pre><code>cd /opt/HCL/wp_profile/bin/

./stopServer.sh WebSphere_Portal -username &lt;username&gt; -password &lt;password&gt;
</code></pre>
<h4 id="4-compress-the-profile">4. Compress the profile</h4>
<p>For the operator-based deployment is the whole core profile located under <code>/opt/HCL/wp_profile</code>. This folder must be compressed.</p>
<pre><code>cd /opt/HCL
tar -cvpzf core_prof_95_CF197.tar.gz --exclude=/core_prof_95_CF197.tar.gz --one-file-system wp_profile
</code></pre>
<h4 id="5-download-the-backup-profile">5. Download the backup profile</h4>
<p>From a local system it is now possible to download the backup core profile from the core pod container.</p>
<pre><code>kubectl cp &lt;namespace&gt;/&lt;pod-name&gt;:&lt;source-file&gt; &lt;target-file&gt;
</code></pre>
<p>Example:</p>
<pre><code>kubectl cp dxns/dx-deployment-0:opt/HCL/core_prof_95_CF197.tar.gz /tmp/core_prof_95_CF197.tar.gz 
</code></pre>
<h3 id="restore-to-the-helm-based-deployment">Restore to the HELM based deployment</h3>
<h4 id="1-start-the-helm-deployment">1. Start the HELM deployment</h4>
<p>Before we can start with the restore we should ensure that the HELM based deployment is in correct state. Some adjustments are necessary.</p>
<ul>
<li>The extraction of kubernetes DX configuration from the operator based deployment to a valid <code>values.yaml</code> file is done.</li>
<li>Enable the <code>migration</code> mode.</li>
<li>For the first start the <code>runtimeController</code> and the <code>core</code> application should be enabled.</li>
</ul>
<p>Now the HELM deployment can be started.</p>
<pre><code>helm install -n &lt;namespace&gt; --create-namespace -f &lt;values.yaml&gt; &lt;prefix&gt; &lt;chart&gt;
</code></pre>
<p>Example:</p>
<pre><code>helm install -n dxns --create-namespace -f hcl-dx-deployment/value-samples/internal-repos.yaml hha hcl-dx-deployment
</code></pre>
<p>What we expected now is:</p>
<ul>
<li>The <code>core</code> pod is running and keep alive.</li>
<li>The <code>core</code> application is NOT running.</li>
<li>No default profile should be created automatically. The folder <code>/opt/HCL/wp_profile</code> is empty.</li>
</ul>
<h4 id="2-upload-the-backup-profile">2. Upload the backup profile</h4>
<p>Now it is possible to transfer the backup profile to the remote core pod container.</p>
<pre><code>kubectl cp &lt;source-file&gt; &lt;namespace&gt;/&lt;pod-name&gt;:&lt;target-file&gt;
</code></pre>
<p>Example:</p>
<pre><code>kubectl cp /tmp/core_prof_95_CF197.tar.gz dxns/hha-core-0:/tmp/core_prof_95_CF197.tar.gz
</code></pre>
<h4 id="3-connect-to-the-core-pod">3. Connect to the core pod</h4>
<p>With the following command it is possible to connect directly into the running container.</p>
<pre><code>kubectl exec --stdin --tty pod/&lt;pod-name&gt; -n &lt;namespace&gt; -- /bin/bash
</code></pre>
<p>Example:</p>
<pre><code>kubectl exec --stdin --tty pod/hha-core-0 -n dxns -- /bin/bash
</code></pre>
<h4 id="4-extracting-the-profile">4. Extracting the profile</h4>
<p>At first the backup file <code>core_prof_95_CF197.tar.gz</code> should moved from <code>/tmp</code> folder to the profile folder <code>/opt/HCL/profiles</code>. And the extraction can be started.</p>
<pre><code>tar -xf /tmp/core_prof_95_CF197.tar.gz --directory /opt/HCL/profiles
mv /opt/HCL/profiles/wp_profile /opt/HCL/profiles/prof_95_CF197
rm /tmp/core_prof_95_CF197.tar.gz
</code></pre>
<p>The next step is to create a symlink.</p>
<pre><code>rm -r /opt/HCL/wp_profile
ln -s /opt/HCL/profiles/prof_95_CF197 /opt/HCL/wp_profile
</code></pre>
<h4 id="5-disable-the-migration-mode-and-the-deployment">5. Disable the migration mode and the deployment</h4>
<p>Before we can start with the final upgrad of the HELM deployment some adjustments are necessary.</p>
<ul>
<li>Disable the <code>migration</code> mode.</li>
<li>Enable all relevant applications.</li>
</ul>
<p>Now the HELM deployment can be upgraded.</p>
<pre><code>helm upgrade -n &lt;namespace&gt; --create-namespace -f &lt;values.yaml&gt; &lt;prefix&gt; &lt;chart&gt;
</code></pre>
<p>Example:</p>
<pre><code>helm upgrade -n dxns --create-namespace -f hcl-dx-deployment/value-samples/internal-repos.yaml hha hcl-dx-deployment
</code></pre>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
 

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.indexes", "navigation.top", "navigation.instant", "navigation.expand", "search.highlight", "search.share", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.361d90f1.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.289a2a4b.min.js"></script>
      
    
  </body>
</html>